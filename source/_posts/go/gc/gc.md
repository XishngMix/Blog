---
title: 常见的垃圾回收机制
date: 2022-09-07 01:20
tags:
- 基本知识
- 底层原理
categories:
- 基本知识
- 垃圾回收
---

## 引用计数
> 对每个对象维护一个引用计数，当引用该对象的对象被销毁时，引用计数减1， 当引用计数器为0时回收该对象

* 优点：对象可以很快被回收，不会出现内存被耗尽或达到某个阀值时才被回收
* 缺点：不能很好的处理循环引用，而且实时的维护引用计数，也存在时间资源的耗费
* 代表语言：Python、PHP、Swift

## 分代收集
> 在JVM虚拟机中，划分为三个代：年轻代(Young Generation)、老年代(Old Generation)和持久代(Permanent Generation)。并按照不同的生命周期将其划分至不同的代空间，不同代空间具有不同的回收算法和回收频率
* 优点：回收性能好
* 缺点：算法过于复杂
* 代表语言：Java

## 标记-清楚
> 从根变量开始遍历所有引用的对象，引用的对象标记为”被引用”，没有被标记的进行回收。
* 优点：解决了引用计数的缺点
* 缺点：需要STW
* 代表语言：Golang(三色标记清除法)

    - 三色标记清除法（白、灰、黑）
        > 出自论文《On-the-fly Garbage Collection: An Exercise in Cooperation》，Golang团队根据该论文在Go语言中实现了垃圾回收算法
        > 
        - 不同颜色代表的含义：
            - 白色集合：允许有指针指向黑色集合
            - 黑色集合：没有任何指针指向白色集合的对象集合
            - 灰色集合：可能会有指针指向白色集合的对象
        
        由上述的定义可知，白色集合时最后要回收的对象集合。下面更具体的讲述该算法的步骤
        
        1. 所有的对象进入白色集合，此时三个集合的状态如下：
            - 白色集合：A B C D E F G H
            - 灰色集合：
            - 黑色集合：
        2. 找到根对象（根对象是指程序能直接访问的对象，比如全局变量），放入灰色集合，此步骤结束后状态如下：
            - 白色集合：B C D F G H
            - 灰色集合：A E
            - 黑色集合：
        3. 取出灰色集合的对象，并把这些对象只想的对象放入到灰色集合，自己则放入黑色集合。如此循环，知道灰色集合为空。该步骤结束后的状态如下：
            - 白色集合：F G H
            - 灰色集合：
            - 黑色集合：A E B C D
        4. 清理白色集合的对象
        
        Golang的垃圾回收是并行处理的，所以在不同的集合之间移动的时候要考虑读写问题。
        Golang的垃圾回收泗洪过修改器(Mutator)和写阻塞(Write Barrier)来完成的。